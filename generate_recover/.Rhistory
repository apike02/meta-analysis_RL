t2_matrix<-confusion_matrix(original,estimated)
ggsave(paste0(datadir,model2,'/t2_confusion_matrix.png'),t2_matrix)
#don't run if you don't want to generate new parameters! can load in saved ones later if that's preferred.
n=1000 #number of 'agents' you want to create
alpha<-rbeta(n,1,1)
alphaloss<-rbeta(n,1,1)
beta<-rgamma(n,5,1)
betaloss<-rgamma(n,5,1)
rewsens<-rgamma(n,3,1)
punsens<-rgamma(n,3,1)
lapse<-rbeta(n,0.5,1.5)
gobias<-rgamma(n,3,1)
appbias<-rgamma(n,3,1)
avbias<-rgamma(n,3,1)
hist(alpha)
hist(alphaloss)
hist(beta)
hist(betaloss)
hist(rewsens)
hist(punsens)
hist(lapse)
hist(gobias)
hist(appbias)
hist(avbias)
generated_parameters=list(alpha=alpha, alphaloss=alphaloss, beta=beta, betaloss=betaloss, rewsens=rewsens, punsens=punsens, lapse=lapse, gobias=gobias, appbias=appbias,avbias=avbias)
save(generated_parameters, file=paste0(workingdir,'/generated_params'))
library('rstan')
model2='1lr1s1lapse'
load(paste0(datadir,model2,'/con_data_t2.RData'))
stanname=paste0('metaRL_',model2,'.stan')
stanfile <- paste0(scriptdir,stanname)
model<-cmdstan_model(stanfile)
fit_t2 <- model$variational(data = con_data_t2, tol_rel_obj = 0.001)
fit_t2$save_object(file=file.path(datadir,model2,'/fit_t2.RDS'))
source(paste0(workingdir,'/analyse_recoverability_vb.R'))
source(paste0(workingdir,'/confusion_matrix.R'))
params_t2<-analyse_recoverability_vb(model2,ntrials,'t2')
original<-do.call(cbind,lapply(params_t2,function(x) x[,1]))
estimated<-do.call(cbind,lapply(params_t2,function(x) x[,2]))
colnames(original)<-lapply(params_t2, function(x) gsub("[[:digit:]]","",rownames(x)[1])) #gets column names
colnames(estimated)<-colnames(original)
t2_matrix<-confusion_matrix(original,estimated)
ggsave(paste0(datadir,model2,'/t2_confusion_matrix.png'),t2_matrix)
#don't run if you don't want to generate new parameters! can load in saved ones later if that's preferred.
n=1000 #number of 'agents' you want to create
alpha<-rbeta(n,1,1)
alphaloss<-rbeta(n,1,1)
beta<-rgamma(n,5,1)
betaloss<-rgamma(n,5,1)
rewsens<-rgamma(n,3,1)
punsens<-rgamma(n,3,1)
lapse<-rbeta(n,0.5,1.5)
gobias<-rgamma(n,3,1)
appbias<-rgamma(n,3,1)
avbias<-rgamma(n,3,1)
hist(alpha)
hist(alphaloss)
hist(beta)
hist(betaloss)
hist(rewsens)
hist(punsens)
hist(lapse)
hist(gobias)
hist(appbias)
hist(avbias)
generated_parameters=list(alpha=alpha, alphaloss=alphaloss, beta=beta, betaloss=betaloss, rewsens=rewsens, punsens=punsens, lapse=lapse, gobias=gobias, appbias=appbias,avbias=avbias)
save(generated_parameters, file=paste0(workingdir,'/generated_params'))
load('C:/Users/apike/OneDrive - University College London/metaRL/generated_params')
ntrials<-150
n=500
source(paste0(workingdir,'gen_rec_dataonly.R'))
model2='1lr1s1lapse'
dir.create(paste0(datadir,model2,'/'))
load(paste0(workingdir,'tasks/task2'))
data_t2<-gen_rec_dataonly(n,task2,model2,'t2',0)
save(data_t2,file=paste0(datadir,model2,'/data_t2'))
data_t2<-as.data.frame(data_t2)
colnames(data_t2)<- c('study','pat/con','id','trial','reward','pun','choices')
data_t2<-transform(data_t2,fullid=paste(study,id,sep='.'))
data_t2$study<-as.numeric(data_t2$study)
data_t2$fullid<-rep(seq(1:length(unique(data_t2$fullid))),each=ntrials)
directory<-paste0(datadir,model2)
write.csv(data_t2,paste0(directory,'/data_t2.csv'))
source(paste0(workingdir,'stanify_data.R'))
stanify_data('t2',directory)
library('rstan')
model2='1lr1s1lapse'
load(paste0(datadir,model2,'/con_data_t2.RData'))
stanname=paste0('metaRL_',model2,'.stan')
stanfile <- paste0(scriptdir,stanname)
model<-cmdstan_model(stanfile)
fit_t2 <- model$variational(data = con_data_t2, tol_rel_obj = 0.001)
fit_t2$save_object(file=file.path(datadir,model2,'/fit_t2.RDS'))
source(paste0(workingdir,'/analyse_recoverability_vb.R'))
source(paste0(workingdir,'/confusion_matrix.R'))
params_t2<-analyse_recoverability_vb(model2,ntrials,'t2')
original<-do.call(cbind,lapply(params_t2,function(x) x[,1]))
estimated<-do.call(cbind,lapply(params_t2,function(x) x[,2]))
colnames(original)<-lapply(params_t2, function(x) gsub("[[:digit:]]","",rownames(x)[1])) #gets column names
colnames(estimated)<-colnames(original)
t2_matrix<-confusion_matrix(original,estimated)
ggsave(paste0(datadir,model2,'/t2_confusion_matrix.png'),t2_matrix)
source(paste0(workingdir,'gen_rec_dataonly.R'))
model2='1lr2s'
dir.create(paste0(datadir,model2,'/'))
load(paste0(workingdir,'tasks/task2'))
data_t2<-gen_rec_dataonly(n,task2,model2,'t2',0)
save(data_t2,file=paste0(datadir,model2,'/data_t2'))
data_t2<-as.data.frame(data_t2)
colnames(data_t2)<- c('study','pat/con','id','trial','reward','pun','choices')
data_t2<-transform(data_t2,fullid=paste(study,id,sep='.'))
data_t2$study<-as.numeric(data_t2$study)
data_t2$fullid<-rep(seq(1:length(unique(data_t2$fullid))),each=ntrials)
directory<-paste0(datadir,model2)
write.csv(data_t2,paste0(directory,'/data_t2.csv'))
source(paste0(workingdir,'stanify_data.R'))
stanify_data('t2',directory)
library('rstan')
model2='1lr2s'
load(paste0(datadir,model2,'/con_data_t2.RData'))
stanname=paste0('metaRL_',model2,'.stan')
stanfile <- paste0(scriptdir,stanname)
model<-cmdstan_model(stanfile)
fit_t2 <- model$variational(data = con_data_t2, tol_rel_obj = 0.001)
fit_t2$save_object(file=file.path(datadir,model2,'/fit_t2.RDS'))
source(paste0(workingdir,'/analyse_recoverability_vb.R'))
source(paste0(workingdir,'/confusion_matrix.R'))
params_t2<-analyse_recoverability_vb(model2,ntrials,'t2')
original<-do.call(cbind,lapply(params_t2,function(x) x[,1]))
estimated<-do.call(cbind,lapply(params_t2,function(x) x[,2]))
colnames(original)<-lapply(params_t2, function(x) gsub("[[:digit:]]","",rownames(x)[1])) #gets column names
colnames(estimated)<-colnames(original)
t2_matrix<-confusion_matrix(original,estimated)
ggsave(paste0(datadir,model2,'/t2_confusion_matrix.png'),t2_matrix)
source(paste0(workingdir,'gen_rec_dataonly.R'))
model2='2lr2s'
dir.create(paste0(datadir,model2,'/'))
load(paste0(workingdir,'tasks/task2'))
data_t2<-gen_rec_dataonly(n,task2,model2,'t2',0)
save(data_t2,file=paste0(datadir,model2,'/data_t2'))
data_t2<-as.data.frame(data_t2)
colnames(data_t2)<- c('study','pat/con','id','trial','reward','pun','choices')
data_t2<-transform(data_t2,fullid=paste(study,id,sep='.'))
data_t2$study<-as.numeric(data_t2$study)
data_t2$fullid<-rep(seq(1:length(unique(data_t2$fullid))),each=ntrials)
directory<-paste0(datadir,model2)
write.csv(data_t2,paste0(directory,'/data_t2.csv'))
source(paste0(workingdir,'stanify_data.R'))
stanify_data('t2',directory)
library('rstan')
model2='2lr2s'
load(paste0(datadir,model2,'/con_data_t2.RData'))
stanname=paste0('metaRL_',model2,'.stan')
stanfile <- paste0(scriptdir,stanname)
model<-cmdstan_model(stanfile)
fit_t2 <- model$variational(data = con_data_t2, tol_rel_obj = 0.001)
fit_t2$save_object(file=file.path(datadir,model2,'/fit_t2.RDS'))
source(paste0(workingdir,'/analyse_recoverability_vb.R'))
source(paste0(workingdir,'/confusion_matrix.R'))
params_t2<-analyse_recoverability_vb(model2,ntrials,'t2')
original<-do.call(cbind,lapply(params_t2,function(x) x[,1]))
estimated<-do.call(cbind,lapply(params_t2,function(x) x[,2]))
colnames(original)<-lapply(params_t2, function(x) gsub("[[:digit:]]","",rownames(x)[1])) #gets column names
colnames(estimated)<-colnames(original)
t2_matrix<-confusion_matrix(original,estimated)
ggsave(paste0(datadir,model2,'/t2_confusion_matrix.png'),t2_matrix)
source(paste0(workingdir,'gen_rec_dataonly.R'))
model2='2lr1s'
dir.create(paste0(datadir,model2,'/'))
load(paste0(workingdir,'tasks/task2'))
data_t2<-gen_rec_dataonly(n,task2,model2,'t2',0)
save(data_t2,file=paste0(datadir,model2,'/data_t2'))
data_t2<-as.data.frame(data_t2)
colnames(data_t2)<- c('study','pat/con','id','trial','reward','pun','choices')
data_t2<-transform(data_t2,fullid=paste(study,id,sep='.'))
data_t2$study<-as.numeric(data_t2$study)
data_t2$fullid<-rep(seq(1:length(unique(data_t2$fullid))),each=ntrials)
directory<-paste0(datadir,model2)
write.csv(data_t2,paste0(directory,'/data_t2.csv'))
source(paste0(workingdir,'stanify_data.R'))
stanify_data('t2',directory)
library('rstan')
model2='2lr1s'
load(paste0(datadir,model2,'/con_data_t2.RData'))
stanname=paste0('metaRL_',model2,'.stan')
stanfile <- paste0(scriptdir,stanname)
model<-cmdstan_model(stanfile)
fit_t2 <- model$variational(data = con_data_t2, tol_rel_obj = 0.001)
fit_t2$save_object(file=file.path(datadir,model2,'/fit_t2.RDS'))
library('rstan')
model2='2lr1s'
load(paste0(datadir,model2,'/con_data_t2.RData'))
stanname=paste0('metaRL_',model2,'.stan')
stanfile <- paste0(scriptdir,stanname)
model<-cmdstan_model(stanfile)
fit_t2 <- model$variational(data = con_data_t2, tol_rel_obj = 0.001)
fit_t2$save_object(file=file.path(datadir,model2,'/fit_t2.RDS'))
source(paste0(workingdir,'/analyse_recoverability_vb.R'))
source(paste0(workingdir,'/confusion_matrix.R'))
params_t2<-analyse_recoverability_vb(model2,ntrials,'t2')
original<-do.call(cbind,lapply(params_t2,function(x) x[,1]))
estimated<-do.call(cbind,lapply(params_t2,function(x) x[,2]))
colnames(original)<-lapply(params_t2, function(x) gsub("[[:digit:]]","",rownames(x)[1])) #gets column names
colnames(estimated)<-colnames(original)
t2_matrix<-confusion_matrix(original,estimated)
ggsave(paste0(datadir,model2,'/t2_confusion_matrix.png'),t2_matrix)
source(paste0(workingdir,'gen_rec_dataonly.R'))
model2='1lr2s1lapse'
dir.create(paste0(datadir,model2,'/'))
load(paste0(workingdir,'tasks/task2'))
data_t2<-gen_rec_dataonly(n,task2,model2,'t2',0)
save(data_t2,file=paste0(datadir,model2,'/data_t2'))
data_t2<-as.data.frame(data_t2)
colnames(data_t2)<- c('study','pat/con','id','trial','reward','pun','choices')
data_t2<-transform(data_t2,fullid=paste(study,id,sep='.'))
data_t2$study<-as.numeric(data_t2$study)
data_t2$fullid<-rep(seq(1:length(unique(data_t2$fullid))),each=ntrials)
directory<-paste0(datadir,model2)
write.csv(data_t2,paste0(directory,'/data_t2.csv'))
source(paste0(workingdir,'stanify_data.R'))
stanify_data('t2',directory)
library('rstan')
model2='1lr2s1lapse'
load(paste0(datadir,model2,'/con_data_t2.RData'))
stanname=paste0('metaRL_',model2,'.stan')
stanfile <- paste0(scriptdir,stanname)
model<-cmdstan_model(stanfile)
fit_t2 <- model$variational(data = con_data_t2, tol_rel_obj = 0.001)
fit_t2$save_object(file=file.path(datadir,model2,'/fit_t2.RDS'))
source(paste0(workingdir,'/analyse_recoverability_vb.R'))
source(paste0(workingdir,'/confusion_matrix.R'))
params_t2<-analyse_recoverability_vb(model2,ntrials,'t2')
original<-do.call(cbind,lapply(params_t2,function(x) x[,1]))
estimated<-do.call(cbind,lapply(params_t2,function(x) x[,2]))
colnames(original)<-lapply(params_t2, function(x) gsub("[[:digit:]]","",rownames(x)[1])) #gets column names
colnames(estimated)<-colnames(original)
t2_matrix<-confusion_matrix(original,estimated)
ggsave(paste0(datadir,model2,'/t2_confusion_matrix.png'),t2_matrix)
library('rstan')
model2='1lr2s1lapse'
load(paste0(datadir,model2,'/con_data_t2.RData'))
stanname=paste0('metaRL_',model2,'.stan')
stanfile <- paste0(scriptdir,stanname)
model<-cmdstan_model(stanfile)
fit_t2 <- model$variational(data = con_data_t2, tol_rel_obj = 0.001)
fit_t2$save_object(file=file.path(datadir,model2,'/fit_t2.RDS'))
source(paste0(workingdir,'/analyse_recoverability_vb.R'))
source(paste0(workingdir,'/confusion_matrix.R'))
params_t2<-analyse_recoverability_vb(model2,ntrials,'t2')
original<-do.call(cbind,lapply(params_t2,function(x) x[,1]))
estimated<-do.call(cbind,lapply(params_t2,function(x) x[,2]))
colnames(original)<-lapply(params_t2, function(x) gsub("[[:digit:]]","",rownames(x)[1])) #gets column names
colnames(estimated)<-colnames(original)
t2_matrix<-confusion_matrix(original,estimated)
ggsave(paste0(datadir,model2,'/t2_confusion_matrix.png'),t2_matrix)
library('rstan')
model2='2lr1s1lapse'
load(paste0(datadir,model2,'/con_data_t2.RData'))
source(paste0(workingdir,'gen_rec_dataonly.R'))
model2='2lr1s1lapse'
dir.create(paste0(datadir,model2,'/'))
load(paste0(workingdir,'tasks/task2'))
data_t2<-gen_rec_dataonly(n,task2,model2,'t2',0)
save(data_t2,file=paste0(datadir,model2,'/data_t2'))
data_t2<-as.data.frame(data_t2)
colnames(data_t2)<- c('study','pat/con','id','trial','reward','pun','choices')
data_t2<-transform(data_t2,fullid=paste(study,id,sep='.'))
data_t2$study<-as.numeric(data_t2$study)
data_t2$fullid<-rep(seq(1:length(unique(data_t2$fullid))),each=ntrials)
directory<-paste0(datadir,model2)
write.csv(data_t2,paste0(directory,'/data_t2.csv'))
source(paste0(workingdir,'stanify_data.R'))
stanify_data('t2',directory)
library('rstan')
model2='2lr1s1lapse'
load(paste0(datadir,model2,'/con_data_t2.RData'))
stanname=paste0('metaRL_',model2,'.stan')
stanfile <- paste0(scriptdir,stanname)
model<-cmdstan_model(stanfile)
fit_t2 <- model$variational(data = con_data_t2, tol_rel_obj = 0.001)
fit_t2$save_object(file=file.path(datadir,model2,'/fit_t2.RDS'))
source(paste0(workingdir,'/analyse_recoverability_vb.R'))
source(paste0(workingdir,'/confusion_matrix.R'))
params_t2<-analyse_recoverability_vb(model2,ntrials,'t2')
original<-do.call(cbind,lapply(params_t2,function(x) x[,1]))
estimated<-do.call(cbind,lapply(params_t2,function(x) x[,2]))
colnames(original)<-lapply(params_t2, function(x) gsub("[[:digit:]]","",rownames(x)[1])) #gets column names
colnames(estimated)<-colnames(original)
t2_matrix<-confusion_matrix(original,estimated)
ggsave(paste0(datadir,model2,'/t2_confusion_matrix.png'),t2_matrix)
fit_t2$summary('loglik')
hist(fit_t2$summary('loglik')$mean)
source(paste0(workingdir,'gen_rec_dataonly.R'))
model2='2lr2s1lapse'
dir.create(paste0(datadir,model2,'/'))
load(paste0(workingdir,'tasks/task2'))
data_t2<-gen_rec_dataonly(n,task2,model2,'t2',0)
save(data_t2,file=paste0(datadir,model2,'/data_t2'))
data_t2<-as.data.frame(data_t2)
colnames(data_t2)<- c('study','pat/con','id','trial','reward','pun','choices')
data_t2<-transform(data_t2,fullid=paste(study,id,sep='.'))
data_t2$study<-as.numeric(data_t2$study)
data_t2$fullid<-rep(seq(1:length(unique(data_t2$fullid))),each=ntrials)
directory<-paste0(datadir,model2)
write.csv(data_t2,paste0(directory,'/data_t2.csv'))
source(paste0(workingdir,'stanify_data.R'))
stanify_data('t2',directory)
library('rstan')
model2='2lr2s1lapse'
load(paste0(datadir,model2,'/con_data_t2.RData'))
stanname=paste0('metaRL_',model2,'.stan')
stanfile <- paste0(scriptdir,stanname)
model<-cmdstan_model(stanfile)
fit_t2 <- model$variational(data = con_data_t2, tol_rel_obj = 0.001)
fit_t2$save_object(file=file.path(datadir,model2,'/fit_t2.RDS'))
source(paste0(workingdir,'/analyse_recoverability_vb.R'))
source(paste0(workingdir,'/confusion_matrix.R'))
params_t2<-analyse_recoverability_vb(model2,ntrials,'t2')
original<-do.call(cbind,lapply(params_t2,function(x) x[,1]))
estimated<-do.call(cbind,lapply(params_t2,function(x) x[,2]))
colnames(original)<-lapply(params_t2, function(x) gsub("[[:digit:]]","",rownames(x)[1])) #gets column names
colnames(estimated)<-colnames(original)
t2_matrix<-confusion_matrix(original,estimated)
ggsave(paste0(datadir,model2,'/t2_confusion_matrix.png'),t2_matrix)
source(paste0(workingdir,'gen_rec_dataonly.R'))
model4='1lr1t'
dir.create(paste0(datadir,model4,'/'))
load(paste0(workingdir,'tasks/task4'))
data_t4<-gen_rec_dataonly(n,task4,model4,'t4',1)
save(data_t4,file=paste0(datadir,model4,'/data_t4'))
data_t4<-as.data.frame(data_t4)
colnames(data_t4)<- c('study','pat_con','id','trial','stim','go_outcome','nogo_outcome','choices')
data_t4<-transform(data_t4,fullid=paste(study,id,sep='.'))
data_t4$study<-as.numeric(data_t4$study)
data_t4$fullid<-rep(seq(1:length(unique(data_t4$fullid))),each=ntrials)
directory<-paste0(datadir,model4)
write.csv(data_t4,paste0(directory,'/data_t4.csv'))
source(paste0(workingdir,'stanify_data_gng.R'))
stanify_data_gng('t4',directory)
library('cmdstanr')
model4='1lr1t'
load(paste0(datadir,model4,'/con_data_t4.RData'))
stanname=paste0('metaRL_',model4,'_gng.stan')
stanfile <- paste0(workingdir, stanname)
model<-cmdstan_model(stanfile)
library('cmdstanr')
model4='1lr1t'
load(paste0(datadir,model4,'/con_data_t4.RData'))
stanname=paste0('metaRL_',model4,'_gng.stan')
stanfile <- paste0(scriptdir, stanname)
model<-cmdstan_model(stanfile)
fit_t4 <- model$variational(data = con_data_t4, tol_rel_obj = 0.001)
#fit_t4<-model$sample(data=con_data_t4,chains = 4,parallel_chains = 4)
fit_t4$save_object(file=file.path(datadir,model4,'/fit_t4.RDS'))
library('cmdstanr')
model4='1lr1t'
load(paste0(datadir,model4,'/con_data_t4.RData'))
stanname=paste0('metaRL_',model4,'_gng.stan')
stanfile <- paste0(scriptdir, stanname)
model<-cmdstan_model(stanfile)
fit_t4 <- model$variational(data = con_data_t4, tol_rel_obj = 0.001)
#fit_t4<-model$sample(data=con_data_t4,chains = 4,parallel_chains = 4)
fit_t4$save_object(file=file.path(datadir,model4,'/fit_t4.RDS'))
source(paste0(workingdir,'/analyse_recoverability_vb.R'))
source(paste0(workingdir,'/analyse_recoverability.R'))
source(paste0(workingdir,'/confusion_matrix.R'))
params_t4<-analyse_recoverability_vb(model4,ntrials,'t4')
#params_t4<-analyse_recoverability(model4,ntrials,'t4')
original<-do.call(cbind,lapply(params_t4,function(x) x[,1]))
estimated<-do.call(cbind,lapply(params_t4,function(x) x[,2]))
colnames(original)<-lapply(params_t4, function(x) gsub("[[:digit:]]","",rownames(x)[1])) #gets column names
colnames(estimated)<-colnames(original)
t4_matrix<-confusion_matrix(original,estimated)
ggsave(paste0(datadir,model4,'/t4_confusion_matrix.png'),t4_matrix)
View(t4_matrix)
View(params_t4)
library('cmdstanr')
model4='1lr2t'
load(paste0(datadir,model4,'/con_data_t4.RData'))
stanname=paste0('metaRL_',model4,'_gng.stan')
stanfile <- paste0(scriptdir, stanname)
model<-cmdstan_model(stanfile)
fit_t4 <- model$variational(data = con_data_t4, tol_rel_obj = 0.001)
#fit_t4<-model$sample(data=con_data_t4,chains = 4,parallel_chains = 4)
fit_t4$save_object(file=file.path(datadir,model4,'/fit_t4.RDS'))
source(paste0(workingdir,'/analyse_recoverability_vb.R'))
source(paste0(workingdir,'/analyse_recoverability.R'))
source(paste0(workingdir,'/confusion_matrix.R'))
params_t4<-analyse_recoverability_vb(model4,ntrials,'t4')
#params_t4<-analyse_recoverability(model4,ntrials,'t4')
original<-do.call(cbind,lapply(params_t4,function(x) x[,1]))
estimated<-do.call(cbind,lapply(params_t4,function(x) x[,2]))
colnames(original)<-lapply(params_t4, function(x) gsub("[[:digit:]]","",rownames(x)[1])) #gets column names
colnames(estimated)<-colnames(original)
t4_matrix<-confusion_matrix(original,estimated)
ggsave(paste0(datadir,model4,'/t4_confusion_matrix.png'),t4_matrix)
fit_t4$summary('loglik')
source(paste0(workingdir,'gen_rec_dataonly.R'))
model4='1lr2t'
dir.create(paste0(datadir,model4,'/'))
load(paste0(workingdir,'tasks/task4'))
data_t4<-gen_rec_dataonly(n,task4,model4,'t4',1)
save(data_t4,file=paste0(datadir,model4,'/data_t4'))
data_t4<-as.data.frame(data_t4)
colnames(data_t4)<- c('study','pat_con','id','trial','stim','go_outcome','nogo_outcome','choices')
data_t4<-transform(data_t4,fullid=paste(study,id,sep='.'))
data_t4$study<-as.numeric(data_t4$study)
data_t4$fullid<-rep(seq(1:length(unique(data_t4$fullid))),each=ntrials)
directory<-paste0(datadir,model4)
write.csv(data_t4,paste0(directory,'/data_t4.csv'))
source(paste0(workingdir,'stanify_data_gng.R'))
stanify_data_gng('t4',directory)
library('cmdstanr')
model4='1lr2t'
load(paste0(datadir,model4,'/con_data_t4.RData'))
stanname=paste0('metaRL_',model4,'_gng.stan')
stanfile <- paste0(scriptdir, stanname)
model<-cmdstan_model(stanfile)
fit_t4 <- model$variational(data = con_data_t4, tol_rel_obj = 0.001)
#fit_t4<-model$sample(data=con_data_t4,chains = 4,parallel_chains = 4)
fit_t4$save_object(file=file.path(datadir,model4,'/fit_t4.RDS'))
source(paste0(workingdir,'/analyse_recoverability_vb.R'))
source(paste0(workingdir,'/analyse_recoverability.R'))
source(paste0(workingdir,'/confusion_matrix.R'))
params_t4<-analyse_recoverability_vb(model4,ntrials,'t4')
#params_t4<-analyse_recoverability(model4,ntrials,'t4')
original<-do.call(cbind,lapply(params_t4,function(x) x[,1]))
estimated<-do.call(cbind,lapply(params_t4,function(x) x[,2]))
colnames(original)<-lapply(params_t4, function(x) gsub("[[:digit:]]","",rownames(x)[1])) #gets column names
colnames(estimated)<-colnames(original)
t4_matrix<-confusion_matrix(original,estimated)
ggsave(paste0(datadir,model4,'/t4_confusion_matrix.png'),t4_matrix)
source(paste0(workingdir,'gen_rec_dataonly.R'))
model4='2lr2t'
dir.create(paste0(datadir,model4,'/'))
load(paste0(workingdir,'tasks/task4'))
data_t4<-gen_rec_dataonly(n,task4,model4,'t4',1)
save(data_t4,file=paste0(datadir,model4,'/data_t4'))
data_t4<-as.data.frame(data_t4)
colnames(data_t4)<- c('study','pat_con','id','trial','stim','go_outcome','nogo_outcome','choices')
data_t4<-transform(data_t4,fullid=paste(study,id,sep='.'))
data_t4$study<-as.numeric(data_t4$study)
data_t4$fullid<-rep(seq(1:length(unique(data_t4$fullid))),each=ntrials)
directory<-paste0(datadir,model4)
write.csv(data_t4,paste0(directory,'/data_t4.csv'))
source(paste0(workingdir,'stanify_data_gng.R'))
stanify_data_gng('t4',directory)
library('cmdstanr')
model4='2lr2t'
load(paste0(datadir,model4,'/con_data_t4.RData'))
stanname=paste0('metaRL_',model4,'_gng.stan')
stanfile <- paste0(scriptdir, stanname)
model<-cmdstan_model(stanfile)
fit_t4 <- model$variational(data = con_data_t4, tol_rel_obj = 0.001)
#fit_t4<-model$sample(data=con_data_t4,chains = 4,parallel_chains = 4)
fit_t4$save_object(file=file.path(datadir,model4,'/fit_t4.RDS'))
source(paste0(workingdir,'/analyse_recoverability_vb.R'))
source(paste0(workingdir,'/analyse_recoverability.R'))
source(paste0(workingdir,'/confusion_matrix.R'))
params_t4<-analyse_recoverability_vb(model4,ntrials,'t4')
#params_t4<-analyse_recoverability(model4,ntrials,'t4')
original<-do.call(cbind,lapply(params_t4,function(x) x[,1]))
estimated<-do.call(cbind,lapply(params_t4,function(x) x[,2]))
colnames(original)<-lapply(params_t4, function(x) gsub("[[:digit:]]","",rownames(x)[1])) #gets column names
colnames(estimated)<-colnames(original)
t4_matrix<-confusion_matrix(original,estimated)
ggsave(paste0(datadir,model4,'/t4_confusion_matrix.png'),t4_matrix)
source(paste0(workingdir,'gen_rec_dataonly.R'))
model4='2lr1t'
dir.create(paste0(datadir,model4,'/'))
load(paste0(workingdir,'tasks/task4'))
data_t4<-gen_rec_dataonly(n,task4,model4,'t4',1)
save(data_t4,file=paste0(datadir,model4,'/data_t4'))
data_t4<-as.data.frame(data_t4)
colnames(data_t4)<- c('study','pat_con','id','trial','stim','go_outcome','nogo_outcome','choices')
data_t4<-transform(data_t4,fullid=paste(study,id,sep='.'))
data_t4$study<-as.numeric(data_t4$study)
data_t4$fullid<-rep(seq(1:length(unique(data_t4$fullid))),each=ntrials)
directory<-paste0(datadir,model4)
write.csv(data_t4,paste0(directory,'/data_t4.csv'))
source(paste0(workingdir,'stanify_data_gng.R'))
stanify_data_gng('t4',directory)
library('cmdstanr')
model4='2lr1t'
load(paste0(datadir,model4,'/con_data_t4.RData'))
stanname=paste0('metaRL_',model4,'_gng.stan')
stanfile <- paste0(scriptdir, stanname)
model<-cmdstan_model(stanfile)
library('cmdstanr')
model4='2lr1t'
load(paste0(datadir,model4,'/con_data_t4.RData'))
stanname=paste0('metaRL_',model4,'_gng.stan')
stanfile <- paste0(scriptdir, stanname)
model<-cmdstan_model(stanfile)
fit_t4 <- model$variational(data = con_data_t4, tol_rel_obj = 0.001)
#fit_t4<-model$sample(data=con_data_t4,chains = 4,parallel_chains = 4)
fit_t4$save_object(file=file.path(datadir,model4,'/fit_t4.RDS'))
source(paste0(workingdir,'/analyse_recoverability_vb.R'))
source(paste0(workingdir,'/analyse_recoverability.R'))
source(paste0(workingdir,'/confusion_matrix.R'))
params_t4<-analyse_recoverability_vb(model4,ntrials,'t4')
source(paste0(workingdir,'/analyse_recoverability_vb.R'))
source(paste0(workingdir,'/analyse_recoverability.R'))
source(paste0(workingdir,'/confusion_matrix.R'))
params_t4<-analyse_recoverability_vb(model4,ntrials,'t4')
#params_t4<-analyse_recoverability(model4,ntrials,'t4')
original<-do.call(cbind,lapply(params_t4,function(x) x[,1]))
estimated<-do.call(cbind,lapply(params_t4,function(x) x[,2]))
colnames(original)<-lapply(params_t4, function(x) gsub("[[:digit:]]","",rownames(x)[1])) #gets column names
colnames(estimated)<-colnames(original)
t4_matrix<-confusion_matrix(original,estimated)
ggsave(paste0(datadir,model4,'/t4_confusion_matrix.png'),t4_matrix)
